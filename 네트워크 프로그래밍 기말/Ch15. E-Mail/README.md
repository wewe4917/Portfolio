# 네트워크 프로그래밍 기말정리
## 전자메일
### > 사용자 환경
- **전자 메일을 이용한 작업은 크게 메일 내용 편집, 수신한 메일 내용 보기, 메일 박스에 보관된 수신 메일 관리 등으로 나눔**
  - 메일 편집
  - 메일 내용 읽기
  - 수신 메일 관리
  - 전달 여부 통지
  - 메일 전달

## 메일 처리
- 전자 메일 주소는 [그림 15-1]과 같이 특별한 형식으로 구성
![image](https://user-images.githubusercontent.com/85292541/206810359-84d2e887-9c31-4287-a160-9286c16a142c.png)
- 수신한 메일을 읽는다는 것은 메일 박스에 저장된 내용을 사용자 하면에 표시해준다는 의미
- **두가지 방법으로 처리**
  - 첫째는 메일 박스가 보관된 서버에 직접 로그인하여 메일 프로그램을 실행함으로써 메일을 확인하는 방법
  - 둘째는 현재 보편적인 사용 방법으로, PC나 스마트폰으로 메일 서버에 보관된 메일을 다운로드하여 관리하는 방법

## 메일 형식
- 메일 내용은 ASCII 코드를 기반으로 한 텍스트 형식으로 정의되지만, 멀티미디어 데이터 사용이 일반화되면서 이를 수용하도록 기능이 확장
- 사용자 헤더는 `<헤더 이름>:<헤더 값>` 형식으로 표현되며, 일반 사용자와 직접 관계되는 주요 헤더는 [표 15-1]
![image](https://user-images.githubusercontent.com/85292541/206810893-e865160a-955e-4c2c-96d7-8c1f1d43ce0f.png)

## MIME
- 7비트 형식의 ASCII 코드가 지원하지 않는 각국의 언어와 이진 데이터 형식의 실행 파일, 영상,음성 등의 데이터를 전송하려면 기능 확장이 반드시 필요
- **MIME은 이러한 필요성에 의해 도입되어 오늘날 전자 메일 환경에서 보편적으로 사용**
  - MIME은 기존에 SMTP 프로토콜에서 사용하던 ASCII 기반의 메시지 형식을 그대로 유지하면서, **메시지 내용에 멀티미디어 데이터 인코딩 방법을 추가로 정의**
  - 송신자는 메일을 전송하기 전에 비-ASKII 데이터를 ASCII 데이터로 변환해야 하며, 수신자를 원래 형식으로 ASII 데이터를 비-ASKII 데이터로 역변환해야 함

![image](https://user-images.githubusercontent.com/85292541/206811114-0eeb0962-c09e-469c-b413-338ee5c97405.png)
- MIME은 다양한 종류의 메일 메시지를 표현하기 위해 5개의 헤더 필드를 정의

![image](https://user-images.githubusercontent.com/85292541/206811225-25d75a73-caee-41c3-a9f0-606f49704f1b.png)
- 메시지의 데이터 종류를 구분하기 위한 Content-type 필드는 타입과 서브 타입으로 나뉘며, `<타입>/<서브타입; 매개변수>`형식으로 표기

![image](https://user-images.githubusercontent.com/85292541/206811417-226c8c4c-3abd-4594-903d-114420fac3d0.png)

## 시스템 구조
- 전자 메일 시스템은 기능에 따라 사용자 환경과 네트워크 환경으로 구분
  - 사용자 환경은 메일을 작성하고 수신하는 사용자 인터페이스 부분
  - 네트워크 환경은 사용자 환경과 인터넷을 이용해 메일을 전달하는 부분

![image](https://user-images.githubusercontent.com/85292541/206811513-28295b0b-c8de-42be-a72b-236af772e089.png)

### > 사용자 환경
- 메일 내용을 읽고 편집하는 일을 담당하는 사용자 인터페이스
- 일반 용어로는 사용자 에이전트라 하며, PC에서 메일을 송수신하는 프로그램

### > 네트워크 환경
- 네트워크 환경을 구성하는 메일 전송 에이전트는 인터넷에서 메일을 송수신하고 중개하는 기능을 담당

## 사용자 에이전트
- 사용자 에이전트는 메일을 송수신하기 위해 이용하는 프로그램

### > 사용자 화면
  - 초기의 메일 프로그램은 텍스트 위주의 환경만 제공하였으므로 사용하기 불편했찌만, 현재는 그래픽 환경이 일반화

![image](https://user-images.githubusercontent.com/85292541/206811720-944b9ccd-cec5-42bb-b5c6-13301fe0b5f9.png)

### > 메일 프로그램 입력 정보
- 메일을 송신하려면 몇 가지 정보를 UA에 입력해야 함
  - 송신자의 메일 주소
  - 수신자의 메일 주소
  - 참조자의 메일 주소
  - 메일의 메시지 헤더: 메일 제목
  - 메일의 메시지 바디: 전송할 메일의 내용

## 메일 전송 에이전트
### > MTA 정보 설정
  - PC나 스마트폰에서 전자 메일 프로그램을 사용하려면 MTA 클라이언트와 MTA 서버에 관한 초기화 설정을 해야함
 
 ![image](https://user-images.githubusercontent.com/85292541/206811855-d99fb33d-0307-42ea-8a99-6a3ae3995d77.png)

### > SMTP와 POP 서비스의 관계
- UA와 MTA를 연동하는 데 사용하는 SMTP와 POP 서비스 간의 관게는 [그림 15-7]과 같음

![image](https://user-images.githubusercontent.com/85292541/206811913-cc2cc126-8d18-4e79-bbfe-8af1f2cc534b.png)

## SMTP 프로토콜
### > STMP의 구조
- SMTP는 메일을 전송하는 SMTP 클라이언트와 메일을 수신하는 SMTP 서버 사이의 데이터 전송에 대한 규칙을 다루며, 명령과 응답의 교환 과정을 통해 메일을 전달
- SMTP 클라이언트는 메일 수신자로 지정한 하나 이상의 SMTP 서버에 메일을 전달
- 이를 위해 SMTP 서버에 대한 접근 가능성 확인, 서버와 연결 설정, 메일 전송이라는 단계를 순차적으로 진행

![image](https://user-images.githubusercontent.com/85292541/206812197-29f6e4e9-a58d-4d37-8c77-767fb6ef6352.png)
- SMTP 프로토콜의 기본 동작 원리는 SMTP 클라이언트와 명령 전송과 이에 대한 SMTP 서버의 응답으로 이루어짐
- SMTP의 명령과 응답은 미리 정의된 문자 코드와 Enter 문자로 구성 (주요한 8개 SMTP 명령)
 
 ![image](https://user-images.githubusercontent.com/85292541/206812323-63d837eb-0cc7-40c0-9c16-f900277babae.png)

## SMTP의 명령과 응답
- 클라이언트가 전송한 명령에 대하여 SMTP 서버는 SMTP 응답기능을 수행
- 응답 정보는 [표 15-5]와 같이 세 자리의 코드와 추가 정보로 구성
- 코드의 첫 문자는 대부분 네트워크 응용 프로토콜에서 공통으로 정의된 2~5 값 중의 하나

![image](https://user-images.githubusercontent.com/85292541/206812470-ba1521af-df5f-4641-bb67-060788727ed5.png)

## SMTP 세션 연결
### > 명령과 응답
- TCP 연결 설정이 정상적으로 이루어지면 [그림 15-9]와 같은 SMTP 세션의 연결 설정 절차가 진행
  - TCP 연결이 설정된 직후의 절차를 나타낸 것이므로 SMTP 서버에서 먼저 SMTP 응답이 이루어지는 것에 유의
  
  ![image](https://user-images.githubusercontent.com/85292541/206812587-c0b82cb7-fd06-4f57-9151-2029ed749b80.png)
- [그림 15-12]의 데이터 전송 단계는 크게 송수신자의 메일 주소 확인(MAIL FROM 명령, RCPT TO 명령), 메일 헤더 정보의 전송(From, To, Date), 하나의 빈 줄에 이어지는 메일 메시지의 전송으로 구분

![image](https://user-images.githubusercontent.com/85292541/206812777-86a24f68-f046-49e4-bc20-1d89886379b3.png)

- 메일 주소 확인
  - 송수신자의 메일 주소 확인 과정에서 SMTP 클라이언트가 SMTP서버에 송신자와 수신자의 메일 주소를 전달
  - 먼저 MAIL 명령을 사용해 송신자 메일 주소를 서버에 전달하는데, 서버에서 오류 상황이 발생하면 이 주소로 오류 내용을 회신 받음

- **메일 헤더 정보 전송**
  - 사용자의 메일 헤더를 서버에 전송하기 위한 것이며, DATA명령에 의해 시작
  - From, To, Date 등과 같이 전송하려면 헤더 정보를 순차적으로 한 줄씩 전송
- **메일 메시지 전송**
  - 송신자의 메일 내용을 전송하는 단계이며, 메시지를 원하는 만큼 순차적으로 전송

## 연결 해제
### > 명령과 응답
  - [그림 15-15]는 SMTP 클라이언트가 QUIT 명령을 전송하고, 그에 따른 SMTP 서버의 응답 코드 221을 회신하는 과정
  ![image](https://user-images.githubusercontent.com/85292541/206813211-c7456b59-77b5-479d-b23f-7bd531467277.png)

## POP 서비스
### > POP 서비스의 필요성
- 호스트 사이의 메일 교환 프로토콜인 SMTP와 별도로 SMTP 서버와 PC/스마트폰을 연동하기 위해 POP 서비스를 사용

![image](https://user-images.githubusercontent.com/85292541/206813282-4f4baad2-a5d3-4e7a-b737-9c3dc6488aad.png)

## POP와 SMTP
### > POP와 SMTP의 비교
- POP 서비스를 수행하는 프로토콜은 기능적으로 SMTP와 동작이 유사하지만 다른 특징이 있음
  - 클라이언트와 서버 사이의 동작은 SMTP처럼 명령과 응답으로 이루어짐
  - **SMTP는 25번 포트를 사용 하고, POP 서비스는 110번 포트를 사용한다**
  - SMTP 클라이언트가 서버와 연결하는 과정에서는 인증 절차가 필요 없지만, **POP 클라이언트가 POP 서버와 연결 할 때는 로그인 이름과 암호를 입력 하는 인증 절차**를 거침
  - PC에서는 인증에 필요한 로그인 이름, 암호 정보가 메일 프로그램을 설치하는 과정에서 초기화되기 때문에 이후에는 인증 절차가 자동으로 처리
### > pop 명령과 응답
  - POP 서비스의 동작은 POP 클라이언트가 POP 서버에 전송하는 명령에 의해 시작
  - POP 서비가 명령을 실행하고, 그 결과를 응답 형식으로 만들어 클라이언트에 회신
  ![image](https://user-images.githubusercontent.com/85292541/206813788-5b809445-1e35-49c5-8eaf-d99c76e08dbe.png)
- POP 클라이언트 명령을 요청방은 POP 서버는 결과를 POP 응답 형식으로 회신

![image](https://user-images.githubusercontent.com/85292541/206813866-7d236869-3623-47d7-a643-2595de02ab0d.png)

## pop 동작 시나리오
### > TCP 연결의 설정과 인증
- POP의 동작

![image](https://user-images.githubusercontent.com/85292541/206813962-f469e4fd-569d-4e8d-85bb-07de4d1bd224.png)
### > 시뮬레이션
- 메일이 보관된 POP 서버를 uu.ac.kr이라 가정하면, POP 클라이언트는 텔넷이 실행되는 kihyun.uu.ac.kr 호스트가 되고 POP 서버는 uu.ac.kr이 됨
- 수신자의 메일 주소는 kihyun@uu.ac.kr, 로그인 이름은 kihyun, 로그인 암호를 kihyun0이라 가정하면 [그림 15-18]과 같은 관계가 성립

![image](https://user-images.githubusercontent.com/85292541/206814126-3f758b42-c0f1-4c83-9808-8e9d3d27ebea.png)
